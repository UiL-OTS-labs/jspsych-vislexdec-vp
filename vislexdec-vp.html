<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jsPsych-6.1.0/jspsych.js"></script>
    <script src="jsPsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jsPsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
    <link href="jsPsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"/>

    <!-- Uil OTS scripts -->
    <script src="stimuli.js"></script>
    <script src="globals.js"></script>
<!--     <script src="test_page.js"></script> -->

  </head>
  <body></body>
  <script>
    var stimuli = pick_random_group();

    // remove logs when the stimuli variable is clear
    console.log("group " + stimuli.group_name);
    console.log("stim_table = " + stimuli.table);
    
    // "test page flows" 
    var start_screen = {
      type: 'html-button-response',
      stimulus: "click me to start anything", 
      choices: ['Okay'],
      response_ends_trial: true
    };

    var end_screen = {
      type: 'html-keyboard-response',
      stimulus: "Thanks, you're done. Press spacebar to see data", 
      choices: ['space']
    };

    var presentFixation = {
      type: 'html-keyboard-response',
      stimulus: '<span style="font-size:40px;">+</span>',
      choices: jsPsych.NO_KEYS,
      trial_duration: FIXCROSS_DURATION
    };

    var presentWord = {
      type: 'html-keyboard-response',
      stimulus: function(){ return "<p class='stimulus'>"+jsPsych.timelineVariable('word', true)+"</p>"; },
      choices: ['z','m'],
      trial_duration: WORD_DURATION,
      post_trial_gap: 0,
      prompt: "<h6> real word [Z] <<<<--     -->>>>> [M] not a word</h6>",
      data: {
            word_type: jsPsych.timelineVariable('item_type'),
          },
      on_finish: function(data){
        if(data.word_type == 'RELATED'){
          var correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode('z');
        } else if (data.word_type == 'UNRELATED'){
          var correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode('z');
        } else {
          var correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode('m');
        }
        data.correct = correct;
      }
    };

    var trialProcedure = {
      timeline:[presentFixation, presentWord],
      timeline_variables: stimuli.table,
      randomize_order:false 
    };

    //defining the timeline 
    var myTimeline = []


    myTimeline.push(start_screen);
    
    // then we call the generic fixation page 
    //myTimeline.push(fixScreen)


    myTimeline.push(trialProcedure);

    
    myTimeline.push(end_screen); 

    // init
    jsPsych.init({
      timeline: myTimeline,
      show_preload_progress_bar: false,
      use_webaudio: false,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    })

    </script>
</html>

